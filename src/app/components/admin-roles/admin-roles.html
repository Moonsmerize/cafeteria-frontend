<div class="admin-container">
  <div class="page-header">
    <h1>Matriz de Permisos (Multirole)</h1>
    <p class="text-muted">Marca las casillas para asignar m√∫ltiples roles a un usuario.</p>
  </div>

  @if (isLoading()) {
    <div class="loading-spinner">Cargando datos...</div>
  } @else {
    <div class="table-responsive">
      <table class="matrix-table">
        <thead>
          <tr>
            <th class="user-col">Usuario / Roles</th>
            @for (rol of roles(); track rol.id) {
              <th class="role-header">
                <div class="role-title">{{ rol.nombre }}</div>
              </th>
            }
          </tr>
        </thead>
        <tbody>
          @for (user of users(); track user.id) {
            <tr [class.highlight]="hasRole(user, 1)"> <td class="user-cell">
                <div class="user-info">
                  <span class="user-name">{{ user.nombreCompleto }}</span>
                  <span class="user-email">{{ user.email }}</span>
                  <div class="role-tags">
                    @for (r of user.roles; track r.id) {
                      <span class="badge-mini">{{ r.nombre }}</span>
                    }
                  </div>
                </div>
              </td>

              @for (rol of roles(); track rol.id) {
                <td class="check-cell">
                  <div class="custom-checkbox">
                    <input type="checkbox" 
                           [id]="'chk_' + user.id + '_' + rol.id"
                           [checked]="hasRole(user, rol.id)"
                           (change)="toggleRole(user, rol.id, $event)">
                    <label [for]="'chk_' + user.id + '_' + rol.id" class="checkmark"></label>
                  </div>
                </td>
              }

            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>