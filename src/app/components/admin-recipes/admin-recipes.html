<div class="admin-container recipe-layout">
  
  <div class="products-panel">
    <h2>Selecciona un Producto</h2>
    <div class="product-list">
      @for (prod of productos(); track prod.id) {
        <div class="product-item" 
             [class.active]="selectedProduct()?.id === prod.id"
             (click)="selectProduct(prod)">
          <div class="prod-info">
            <span class="prod-name">{{ prod.nombre }}</span>
            <small>{{ prod.categoria }}</small>
          </div>
          <i class="bi bi-chevron-right"></i>
        </div>
      }
    </div>
  </div>

  <div class="recipe-panel">
    @if (selectedProduct(); as prod) {
      <div class="recipe-header">
        <h3>Receta para: <strong>{{ prod.nombre }}</strong></h3>
        <span class="badge-info">Define qué insumos se descuentan al vender esto.</span>
      </div>

      <div class="add-ingredient-box">
        <form [formGroup]="recipeForm" (ngSubmit)="addIngredient()">
          <div class="row">
            <div class="col-grow">
              <label>Insumo (Inventario)</label>
              <select formControlName="idInventario">
                <option value="" disabled selected>Selecciona insumo...</option>
                @for (ins of insumos(); track ins.id) {
                  <option [value]="ins.id">{{ ins.nombre }} (Stock: {{ ins.stockActual }})</option>
                }
              </select>
            </div>
            <div class="col-small">
              <label>Cantidad</label>
              <input type="number" formControlName="cantidadRequerida" step="0.01">
            </div>
            <div class="col-btn">
              <button type="submit" class="btn-add" [disabled]="recipeForm.invalid">
                <i class="bi bi-plus-lg"></i> Agregar
              </button>
            </div>
          </div>
        </form>
      </div>

      <div class="table-responsive">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Insumo</th>
              <th>Cantidad Requerida</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for (item of currentRecipe(); track item.id) {
              <tr>
                <td>{{ item.inventario?.nombre }}</td>
                <td><strong>{{ item.cantidadRequerida }}</strong></td>
                <td>
                  <button class="btn-icon delete" (click)="removeIngredient(item.id)">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="3" class="text-center text-muted">Este producto no tiene receta definida (se descontará solo).</td>
              </tr>
            }
          </tbody>
        </table>
      </div>

    } @else {
      <div class="empty-state">
        <i class="bi bi-basket"></i>
        <p>Selecciona un producto de la izquierda para gestionar su receta.</p>
      </div>
    }
  </div>

</div>